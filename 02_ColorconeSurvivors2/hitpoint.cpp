//=========================================================================================
//
// ヒットポイント　[hitpoint.cpp]
// Author:日野澤匠泉
//
//=========================================================================================

//*****************************************************************************************
//インクルード
//*****************************************************************************************
#include "hitpoint.h"
#include "renderer.h"
#include "manager.h"
#include "object2D.h"
#include "boss.h"
#include "game.h"

//*****************************************************************************************
//静的メンバ変数初期化
//*****************************************************************************************
LPDIRECT3DTEXTURE9 CHitpoint::m_pTexture = nullptr;

//=========================================================================================
//ヒットポイントのコンストラクタ
//=========================================================================================
CHitpoint::CHitpoint()
{

}

//=========================================================================================
//ヒットポイントのデストラクタ
//=========================================================================================
CHitpoint::~CHitpoint()
{

}

//=========================================================================================
//ヒットポイントのテクスチャ読み込み
//=========================================================================================
HRESULT CHitpoint::Load(void)
{
	//オブジェクト取得
	CRenderer* pRenderer = CManager::GetManager()->GetRenderer();

	//デバイス取得
	LPDIRECT3DDEVICE9 pDevice = pRenderer->GetDevice();

	//テクスチャの読み込み
	D3DXCreateTextureFromFile(pDevice,
		"data\\TEXTURE\\hp.png",
		&m_pTexture);

	return S_OK;
}

//=========================================================================================
//ヒットポイントのテクスチャ破棄
//=========================================================================================
void CHitpoint::Unload(void)
{
	//テクスチャの破棄
	if (m_pTexture != NULL)
	{
		m_pTexture->Release();
		m_pTexture = NULL;
	}
}


//=========================================================================================
//ヒットポイントの初期化処理
//=========================================================================================
HRESULT CHitpoint::Init(void)
{
	//オブジェクトの初期化処理
	CObject2D::Init();

	//種類の設定
	SetType(TYPE_HITPOINT);

	return S_OK;
}

//=========================================================================================
//ヒットポイントの終了処理
//=========================================================================================
void CHitpoint::Uninit(void)
{
	//オブジェクトの終了処理
	CObject2D::Uninit();
}

//=========================================================================================
//ヒットポイントの更新処理
//=========================================================================================
void CHitpoint::Update(void)
{
	int nBossLife = CGame::GetBoss()->GetLife();
	
	float fWidth = nBossLife / 300.0f * 300.0f;

	//位置設定
	Set(D3DXVECTOR3(330.0f + fWidth, 40.0f, 0.0f), D3DXVECTOR3(0.0f, 0.0f, 0.0f), 30.0f, fWidth);
}

//=========================================================================================
//ヒットポイントの描画処理
//=========================================================================================
void CHitpoint::Draw(void)
{
	//オブジェクトの描画処理
	CObject2D::Draw();
}

//=========================================================================================
//ヒットポイントの設定処理
//=========================================================================================
CHitpoint* CHitpoint::Create(void)
{
	//ポインタの変数を宣言
	CHitpoint* pHp;

	//オブジェクト2Dの生成
	pHp = new CHitpoint;

	if (pHp != nullptr)
	{//使用されているとき

		//初期化処理
		pHp->Init();

		//テクスチャの割り当て
		pHp->BindTexture(m_pTexture);
	}

	//オブジェクト情報を返す
	return pHp;
}
